# ğŸš— SmartFlow - Há»‡ thá»‘ng Ä‘á»‹nh tuyáº¿n giao thÃ´ng thÃ´ng minh

> **Äá»“ Ã¡n mÃ´n TÆ° duy tÃ­nh toÃ¡n - HCMUS 2025**  
> Há»‡ thá»‘ng tÃ¬m Ä‘Æ°á»ng tá»‘i Æ°u vá»›i mÃ´ phá»ng táº¯c ngháº½n giao thÃ´ng  sá»­ dá»¥ng thuáº­t toÃ¡n Dijkstra vÃ  mÃ´ hÃ¬nh BPR (Bureau of Public Roads).



---

## ğŸ“‹ Má»¥c lá»¥c
- [Giá»›i thiá»‡u](#-giá»›i-thiá»‡u)
- [TÃ­nh nÄƒng](#-tÃ­nh-nÄƒng-chÃ­nh)
- [CÃ i Ä‘áº·t](#-cÃ i-Ä‘áº·t)
- [Sá»­ dá»¥ng](#-hÆ°á»›ng-dáº«n-sá»­-dá»¥ng)
- [ÄÃ¡nh giÃ¡](#-evaluation)
- [Cáº¥u trÃºc project](#-cáº¥u-trÃºc-project)
- [API](#-api-endpoints)

---

## ğŸ“ Giá»›i thiá»‡u

**SmartFlow** lÃ  há»‡ thá»‘ng Ä‘á»‹nh tuyáº¿n giao thÃ´ng thÃ´ng minh Ä‘Æ°á»£c phÃ¡t triá»ƒn nhÆ° Ä‘á»“ Ã¡n mÃ´n **TÆ° duy tÃ­nh toÃ¡n** táº¡i TrÆ°á»ng Äáº¡i há»c Khoa há»c Tá»± nhiÃªn (HCMUS), nÄƒm há»c 2025-2026.

### ğŸ¯ Má»¥c tiÃªu
- TÃ¬m Ä‘Æ°á»ng tá»‘i Æ°u giá»¯a 2 Ä‘iá»ƒm trÃªn báº£n Ä‘á»“ TP.HCM (Quáº­n TÃ¢n BÃ¬nh)
- MÃ´ phá»ng tÃ¡c Ä‘á»™ng cá»§a táº¯c ngháº½n giao thÃ´ng Ä‘áº¿n thá»i gian di chuyá»ƒn
- Ãp dá»¥ng mÃ´ hÃ¬nh BPR (Bureau of Public Roads, 1964) Ä‘á»ƒ tÃ­nh toÃ¡n Ä‘á»™ trá»… do congestion
- Cung cáº¥p nhiá»u tuyáº¿n Ä‘Æ°á»ng thay tháº¿ vá»›i Ä‘á»™ Ä‘a dáº¡ng cao

### ğŸ”¬ CÆ¡ sá»Ÿ khoa há»c
- **Thuáº­t toÃ¡n:** Dijkstra's Shortest Path (1959)
- **MÃ´ hÃ¬nh congestion:** BPR Function - `t = tâ‚€[1 + Î±(v/c)^Î²]`
- **Nguá»“n dá»¯ liá»‡u:** OpenStreetMap (OSM) - chuáº©n quá»‘c táº¿
- **ThÆ° viá»‡n:** NetworkX, OSMnx, Flask, Leaflet.js

### ğŸ“Š ÄÃ¡nh giÃ¡ há»‡ thá»‘ng
- **30 test cases** vá»›i statistical validity (n=30, 95% CI, Â±18% error)
- **Overall Score:** 85/100 (Grade A)
- **Route Diversity:** 0.416 (target >0.3) âœ…
- **Response Time:** <1s average (Nielsen's excellent threshold) âœ…
- **Comprehensive evaluation** vá»›i 11+ scientific references

---

## âœ¨ TÃ­nh nÄƒng chÃ­nh

### ğŸ”¹ Core Features
âœ… **TÃ¬m Ä‘Æ°á»ng thÃ´ng minh** - Dijkstra + BPR model vá»›i 3 routes thay tháº¿  
âœ… **MÃ´ phá»ng táº¯c ngháº½n** - ThÃªm congestion zones báº±ng click/path drawing  
âœ… **Baseline comparison** - So sÃ¡nh route hiá»‡n táº¡i vs. shortest path khÃ´ng táº¯c  
âœ… **Route diversity** - 1-2 tuyáº¿n Ä‘Æ°á»ng khÃ¡c biá»‡t (Jaccard Distance >0.3)  
  

### ğŸ”¹ Technical Features
âœ… **Dá»¯ liá»‡u thá»±c táº¿** - OSM graph: 1,487 nodes, 3,420 edges (TÃ¢n BÃ¬nh District)  
âœ… **Há»— trá»£ háº»m nhá»** - Bao gá»“m residential roads (khÃ¡c biá»‡t vá»›i Google Maps)  
âœ… **Adjustable parameters** - Thay Ä‘á»•i Î±, Î², capacity real-time  
âœ… **Graph caching** - Load nhanh vá»›i pickle serialization  
âœ… **Responsive UI** - Leaflet.js interactive map  

---

## ğŸš€ CÃ i Ä‘áº·t

### ğŸ“¦ YÃªu cáº§u há»‡ thá»‘ng
- **Python:** 3.11 hoáº·c cao hÆ¡n
- **Storage:** ~200MB cho dependencies + graph cache
- **OS:** Windows/Linux/macOS

### 1ï¸âƒ£ Clone repository
```bash
git clone https://github.com/thinhelzan842/SmartFlow.git
cd SmartFlow
```

### 2ï¸âƒ£ Táº¡o virtual environment (optional)
```bash
# Windows
python -m venv .venv
.venv\Scripts\activate

# Linux/macOS
python3 -m venv .venv
source .venv/bin/activate
```

### 3ï¸âƒ£ CÃ i Ä‘áº·t dependencies
```bash
pip install -r requirements.txt
```

**Dependencies chÃ­nh:**
- `flask==3.0.0` - Web framework
- `networkx==3.4.2` - Graph algorithms
- `osmnx==2.0.0` - OpenStreetMap data
- `numpy`, `pandas` - Data processing

### 4ï¸âƒ£ Cháº¡y á»©ng dá»¥ng
```bash
python app.py
```

**Output mong Ä‘á»£i:**
```
============================================================
SmartFlow Traffic Routing System
============================================================

Initializing...
Loading graph from cache: graph_with_congestion.gpickle
Graph is not strongly connected, extracting largest component...
Using largest component: 1487 nodes, 3420 edges
Routing system initialized with Î±=1.5, Î²=8, capacity=0.4

âœ“ System ready!
============================================================

Starting web server...
Running in production mode on port 5000
 * Running on http://127.0.0.1:5000
```

### 5ï¸âƒ£ Má»Ÿ trÃ¬nh duyá»‡t
Truy cáº­p: **http://localhost:5000**

---

## ğŸ“– HÆ°á»›ng dáº«n sá»­ dá»¥ng

### ğŸ—ºï¸ Cháº¿ Ä‘á»™ "TÃ¬m Ä‘Æ°á»ng"
1. Click nÃºt **"Cháº¿ Ä‘á»™ tÃ¬m Ä‘Æ°á»ng"** (mÃ u xanh)
2. Click **Ä‘iá»ƒm A** trÃªn báº£n Ä‘á»“ (xuáº¥t phÃ¡t) â†’ marker xanh lÃ¡ xuáº¥t hiá»‡n
3. Click **Ä‘iá»ƒm B** trÃªn báº£n Ä‘á»“ (Ä‘Ã­ch Ä‘áº¿n) â†’ marker Ä‘á» xuáº¥t hiá»‡n
4. Há»‡ thá»‘ng tá»± Ä‘á»™ng hiá»ƒn thá»‹:
   - **Route 1** (mÃ u xanh dÆ°Æ¡ng Ä‘áº­m) - Tuyáº¿n tá»‘i Æ°u nháº¥t
   - **Route 2** (mÃ u xanh lÃ¡) - Tuyáº¿n thay tháº¿ 1

5. Click vÃ o marker Ä‘á»ƒ xem thÃ´ng tin chi tiáº¿t (khoáº£ng cÃ¡ch, thá»i gian)

### ğŸš§ Cháº¿ Ä‘á»™ "ThÃªm táº¯c Ä‘Æ°á»ng"
1. Click nÃºt **"ThÃªm táº¯c Ä‘Æ°á»ng"** (mÃ u Ä‘á»)

2. **Váº½ path:**
   - Click nhiá»u Ä‘iá»ƒm liÃªn tiáº¿p Ä‘á»ƒ váº½ path
   - Táº¥t cáº£ segments trÃªn path Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u táº¯c

### ğŸ”„ Cháº¿ Ä‘á»™ "XÃ³a táº¯c Ä‘Æ°á»ng"
1. Click nÃºt **"XÃ³a táº¯c Ä‘Æ°á»ng"** (mÃ u xanh nháº¡t)
2. Click vÃ o Ä‘oáº¡n Ä‘Æ°á»ng mÃ u Ä‘á» Ä‘á»ƒ xÃ³a congestion
3. MÃ u Ä‘á» biáº¿n máº¥t, route tá»± Ä‘á»™ng recalculate

### âš™ï¸ Äiá»u chá»‰nh tham sá»‘ BPR

**CÃ´ng thá»©c BPR:** `t = tâ‚€ Ã— [1 + Î± Ã— (v/c)^Î²]`

- **Alpha (Î±)**: 0.1 - 5.0 (máº·c Ä‘á»‹nh: **1.5**)
  - Há»‡ sá»‘ áº£nh hÆ°á»Ÿng tuyáº¿n tÃ­nh cá»§a congestion
  - CÃ ng cao â†’ táº¯c ngháº½n áº£nh hÆ°á»Ÿng cÃ ng máº¡nh
  
- **Beta (Î²)**: 1 - 15 (máº·c Ä‘á»‹nh: **8**)
  - Há»‡ sá»‘ phi tuyáº¿n (Ä‘á»™ cong Ä‘Æ°á»ng cong)
  - Chuáº©n BPR 1964: Î²=4, Project nÃ y: Î²=8 (nháº¡y hÆ¡n)
  
- **Capacity (c)**: 0.1 - 1.0 (máº·c Ä‘á»‹nh: **0.4**)
  - 0.4 = 40% capacity (má»—i Ä‘oáº¡n Ä‘Æ°á»ng chá»©a ~40 xe)
  - Tháº¥p hÆ¡n â†’ dá»… bá»‹ táº¯c

**CÃ¡ch thay Ä‘á»•i:**
1. Má»Ÿ sidebar bÃªn pháº£i
2. KÃ©o slider hoáº·c nháº­p giÃ¡ trá»‹
3. Click "Cáº­p nháº­t" â†’ BPR weights recalculate toÃ n bá»™ graph

---

## ğŸ“Š Evaluation

### ğŸ¯ Comprehensive Test Suite
- **30 test cases** vá»›i statistical validity
- Coverage: 10 short/10 medium/10 long distance
- Congestion patterns: 80+ unique segments
- Geographic: 10 north-south/10 east-west/10 diagonal

### ğŸ“ˆ Evaluation Results
| Metric | Score | Target | Status |
|--------|-------|--------|--------|
| **Overall** | **85/100** | â‰¥70 | âœ… **Grade A** |
| Routing Quality | 94.8/100 | â‰¥80 | âœ… |
| Performance | 100/100 | â‰¥75 | âœ… |
| BPR Accuracy | 65.0/100 | â‰¥60 | âœ… |
| UX Score | 90.3/100 | â‰¥70 | âœ… |

**Chi tiáº¿t:**
- **Route Diversity:** 0.416 (target >0.3)
- **Route Quality:** 0.985 (target >0.95)
- **Congestion Avoidance:** 0.880 (target >0.85)
- **Avg Response Time:** 0.15s (target <5s)

### ğŸ“š Scientific References
Evaluation dá»±a trÃªn 11+ published papers vÃ  tiÃªu chuáº©n quá»‘c táº¿:
- Dijkstra (1959), Jaccard (1901), Wardrop (1952)
- Bureau of Public Roads (1964), Nielsen (1993)
- ISO 9241-11:2018, Li et al. (2011), Bader et al. (2011)

ğŸ‘‰ **Chi tiáº¿t:** Xem `evaluation.ipynb` vÃ  `EVALUATION_REFERENCES.md`

---

## ğŸ—ï¸ Cáº¥u trÃºc project

```
SmartFlow/
â”œâ”€â”€ ğŸ“„ app.py                            # Flask web server
â”œâ”€â”€ ğŸ“„ routing_logic.py                  # Core routing logic (BPR + Dijkstra)
â”œâ”€â”€ ğŸ“Š evaluation.ipynb                  # Comprehensive evaluation notebook
â”œâ”€â”€ ğŸ“‹ test_cases_comprehensive.json     # 30 test cases
â”œâ”€â”€ ğŸ“„ evaluation_report.json            # Evaluation results
â”œâ”€â”€ ğŸ–¼ï¸ evaluation_results.png            # Visualization charts
â”‚
â”œâ”€â”€ ğŸ“¦ graph_with_congestion.gpickle     # Cached OSM graph (1487 nodes, 3420 edges)
â”‚
â”œâ”€â”€ ğŸ“ templates/
â”‚   â””â”€â”€ index.html                       # Web UI
â”œâ”€â”€ ğŸ“ static/
â”‚   â”œâ”€â”€ style.css                        # Styling
â”‚   â””â”€â”€ app.js                           # Frontend logic (Leaflet.js)
â”‚
â”œâ”€â”€ ğŸ“„ requirements.txt                  # Python dependencies
â”œâ”€â”€ ğŸ“„ .gitignore                        # Git ignore rules
â”œâ”€â”€ ğŸ“„ Procfile                          # Heroku deployment
â”œâ”€â”€ ğŸ“„ runtime.txt                       # Python version for deployment
â”‚
â”œâ”€â”€ ğŸ“š README.MD                         # ğŸ‘ˆ Báº¡n Ä‘ang Ä‘á»c file nÃ y
â”œâ”€â”€ ğŸ“š README_DEPLOY.md                  # Deployment guide
â”œâ”€â”€ ğŸ“š EVALUATION_REFERENCES.md          # Scientific references
â””â”€â”€ ğŸ“š CAU_TRA_LOI_DANH_GIA.md          # Q&A for evaluation
```

**Key files:**
- `routing_logic.py` - 28KB, chá»©a SmartRoutingSystem class
- `evaluation.ipynb` - 528KB, 16+ cells vá»›i comprehensive evaluation
- `graph_with_congestion.gpickle` - 1MB, OSM graph cache

---

## ğŸ”§ API Endpoints

### `POST /api/find_route`
TÃ¬m Ä‘Æ°á»ng giá»¯a 2 Ä‘iá»ƒm

**Request:**
```json
{
    "start_lat": 10.8006,
    "start_lon": 106.6503,
    "end_lat": 10.8050,
    "end_lon": 106.6550,
    "num_search": 20,
    "num_display": 3
}
```

**Response:**
```json
{
    "success": true,
    "routes": [
        {
            "distance": 1250.5,
            "time": 180.2,
            "path": [...],
            "geometry": [[[lat, lon], ...]]
        }
    ],
    "baseline_distance": 1100.0,
    "baseline_geometry": [[lat, lon], ...]
}
```

### `POST /api/add_congestion_path`
ThÃªm táº¯c ngháº½n theo path (nhiá»u Ä‘iá»ƒm)

**Request:**
```json
{
    "points": [
        [10.8006, 106.6503],
        [10.8020, 106.6520],
        [10.8035, 106.6540]
    ],
    "vehicle_count": 100
}
```

### `POST /api/remove_congestion`
XÃ³a táº¯c ngháº½n táº¡i 1 Ä‘iá»ƒm

**Request:**
```json
{
    "lat": 10.8006,
    "lon": 106.6503
}
```

### `POST /api/reset_congestion`
Reset toÃ n bá»™ táº¯c ngháº½n vá» 0

### `POST /api/update_parameters`
Cáº­p nháº­t tham sá»‘ BPR

**Request:**
```json
{
    "alpha": 1.5,
    "beta": 8,
    "capacity_factor": 0.4
}
```

---

## ğŸ› ï¸ Troubleshooting

### âŒ Lá»—i: Module not found
```bash
pip install -r requirements.txt
```

### âŒ Lá»—i: Graph file not found
- XÃ³a cache cÅ©: `rm graph_with_congestion.gpickle`
- Cháº¡y láº¡i: `python app.py` (sáº½ tá»± Ä‘á»™ng download tá»« OSM)

### âŒ Lá»—i: Port 5000 already in use
```bash
# Windows: TÃ¬m vÃ  kill process
netstat -ano | findstr :5000
taskkill /PID <PID> /F

# Linux/Mac
lsof -ti:5000 | xargs kill -9
```

### âŒ Lá»—i: Cannot find route between points
- Kiá»ƒm tra 2 Ä‘iá»ƒm cÃ³ cÃ¹ng connected component khÃ´ng
- Thá»­ Ä‘iá»ƒm khÃ¡c gáº§n trung tÃ¢m quáº­n TÃ¢n BÃ¬nh

---

## ğŸš€ Deployment

### Railway Deployment

---

## ğŸ“ License & Credits

### ğŸ‘¨â€ğŸ’» TÃ¡c giáº£
- **Sinh viÃªn:** 
20127552 â€“ VÆ°Æ¡ng Huá»³nh Táº¥n Lá»™c
21127738 â€“ Tráº§n Báº£o Ngá»c
23127465 â€“ Nguyá»…n Há»“ Anh Quá»‘c
23127518 â€“ Tráº§n Quá»‘c Viá»‡t
24127244 â€“ Pháº¡m Táº¥n Nháº­t Thá»‹nh
- **Lá»›p:** 24C6
- **MÃ´n há»c:** TÆ° duy tÃ­nh toÃ¡n
- **Giáº£ng viÃªn:** 
tháº§y BÃ¹i Duy ÄÄƒng
tháº§y Huá»³nh LÃ¢m Háº£i ÄÄƒng
tháº§y Nguyá»…n Thanh TÃ¬nh
- **TrÆ°á»ng:** Äáº¡i há»c Khoa há»c Tá»± nhiÃªn (HCMUS) - ÄHQG TP.HCM
- **NÄƒm há»c:** 2025-2026 HK1

### ğŸ“š References
1. **Dijkstra, E. W.** (1959). "A note on two problems in connexion with graphs"
2. **Bureau of Public Roads** (1964). "Traffic Assignment Manual"
3. **Jaccard, P.** (1901). "Ã‰tude comparative de la distribution florale"
4. **Wardrop, J.** (1952). "Road Traffic Research"
5. **Nielsen, J.** (1993). "Usability Engineering"
6. **ISO 9241-11:2018** - Ergonomics of human-system interaction
7. **Boeing, G.** (2017). "OSMnx: New methods for acquiring street networks"

### ğŸ™ Acknowledgments
- **OpenStreetMap** contributors for map data
- **NetworkX** team for graph algorithms library
- **OSMnx** team for OpenStreetMap Python library
- **Flask** team for web framework
- **Leaflet.js** team for interactive maps

---

## ğŸ“ Contact & Support

- **GitHub:** https://github.com/thinhelzan842/SmartFlow
- **Issues:** https://github.com/thinhelzan842/SmartFlow/issues
- **Email:** thinhelzan842@gmail.com

---

## ğŸ“Œ Changelog

### v2.0 (Jan 2026) - Clean & Optimized
- ğŸ§¹ Removed 12 dead functions from routing_logic.py
- ğŸ—‘ï¸ Deleted ~100 unused files (old demos, CSV, cache)
- ğŸ“Š Added comprehensive evaluation (30 test cases)
- ğŸ“š Added scientific references document
- ğŸ¯ Overall score: 85/100 (Grade A)

### v1.0 (Dec 2025) - Initial Release
- âœ… Basic routing with Dijkstra + BPR
- âœ… Interactive map with Leaflet.js
- âœ… Congestion simulation
- âœ… Parameter adjustment

---

**â­ Náº¿u project nÃ y há»¯u Ã­ch, hÃ£y Ä‘á»ƒ láº¡i 1 star trÃªn GitHub!**

---

<div align="center">
  <strong>Made with â¤ï¸ for HCMUS Computational Thinking Course</strong>
  <br>
  <sub>Â© 2025-2026 SmartFlow Project</sub>
</div>

